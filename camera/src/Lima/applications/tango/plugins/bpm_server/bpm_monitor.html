<html>
  <link rel="stylesheet" href="hsd-flotr2.css" type="text/css"></link>
  <head> 
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
    <META HTTP-EQUIV="Pragma-directive" CONTENT="no-cache">
    <META HTTP-EQUIV="Cache-Directive" CONTENT="no-cache">
    <META HTTP-EQUIV="Expires" CONTENT="0">
    <title>%s</title>
    <script language="JavaScript" type="text/javascript" src="uki.js"></script>
    <script language="JavaScript" type="text/javascript" src="uki-more.js"></script>
    <script language="JavaScript" type="text/javascript" src="jquery.min.js"></script>
    <script language="JavaScript" type="text/javascript" src="jquery.parsequery.js"></script>
    <script language="JavaScript" type="text/javascript" src="json2.js"></script>
    <!--<script language="JavaScript" type="text/javascript" src="msgpack.js"></script>-->
    <script language="JavaScript" type="text/javascript" src="flotr2.min.js"></script>
    <script language="javascript" type="text/javascript" src="graphs.js"></script>
    <script language="javascript" type="text/javascript" src="bv.js"></script>
  </head>
  <body>
   <script>
      uki.view.declare('uki.view.Canvas', uki.view.Base, function(Base) {
        this._createDom = function() {
          this._dom = uki.createElement('canvas', this.defaultCss +
             'border:none;left:0;top:0;width:100%%;height:100%%');
        };

        this._layoutDom = function(rect) {
          Base._layoutDom.call(this, rect);
          //this._dom.width = rect.width;
          //this._dom.height = rect.height;
        };
      });

      uki.view.declare('uki.view.GraphCanvas', uki.view.Base, function(Base) {
        this._createDom = function() {
          this._dom = uki.createElement('div', this.defaultCss +
             'border:none;left:0;top:0;width:100%%;height:100%%');
        };

        this._layoutDom = function(rect) {
          Base._layoutDom.call(this, rect);
          this._dom.width = rect.width;
          this._dom.height = rect.height;
        };
      });

      uki({
        view: 'Box', id: 'main', rect: '1240 1000', anchors: 'left top right bottom',
        childViews: [{ view: 'HFlow', rect: '10 10 1230 24', anchors: 'left top', id: 'toolbar'  } ]
      }).attachTo(window); 

      window.onload = function() {
        $.ajax({
          error: function(XMLHttpRequest, textStatus, errorThrown) { alert(textStatus) },
          url: 'get_bpms',
          type: 'GET',
          async: false,
          timeout: 3000,
          success: function(res) {
            for(var i=0;i<res.all_bpms.length;i++) {
              var bpm = res.all_bpms[i]
              var key = bpm['key']
              var panel_name = "#panel_"+key
              var panel = uki({ id: "panel_"+key, view: 'Box', rect: '10 34 1230 966', anchors: 'left top', background: 'theme(panel)'})[0];
              uki("#main").appendChild(panel)
              panel.visible(false)

              var x = i*5+(i-1)*165;
              var btn_rect = x+" 0 165 24";
              var new_btn = uki({view: 'uki.more.view.RadioButton', group: 'group 1', rect: btn_rect, anchors: 'left top', text: bpm["name"] })[0];
 
              uki('#toolbar').appendChild(new_btn);

              new_btn.panel_name = panel_name     
              new_btn.all_bpms = res.all_bpms
              if (bpm.type == 'bv') {
                  new_btn.view = new bv_view()
                  new_btn.view.init(panel, key)
              }

              new_btn.click_func = function() { 
                for (var i=0;i<this.all_bpms.length;i++) {
                  var key = this.all_bpms[i]["key"]
                  uki("#panel_"+key).visible(false)
                }
                uki(this.panel_name)
                  .visible(true) 
                  .resizeToContents('width height').layout().parent().resizeToContents('width height').layout();
              }

              new_btn.bind('click', new_btn.click_func)
            
              if (i==0) { new_btn.checked(1); new_btn.click_func() }
            } 
          },
          dataType: "json" }) 
      };
    </script>
  </body>
</html>
